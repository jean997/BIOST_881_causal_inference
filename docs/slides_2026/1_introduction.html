<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>L1: Getting Started</title>
    <meta charset="utf-8" />
    <meta name="author" content="Jean Morrison" />
    <script src="libs/header-attrs-2.29/header-attrs.js"></script>
    <link href="libs/tile-view-0.2.6/tile-view.css" rel="stylesheet" />
    <script src="libs/tile-view-0.2.6/tile-view.js"></script>
    <script src="libs/mark.js-8.11.1/mark.min.js"></script>
    <link href="libs/xaringanExtra-search-0.0.1/search.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-search-0.0.1/search.js"></script>
    <script>window.addEventListener('load', function() { window.xeSearch = new RemarkSearch({"position":"bottom-left","caseSensitive":false,"showIcon":true,"autoSearch":true}) })</script>
    <link href="libs/panelset-0.3.0/panelset.css" rel="stylesheet" />
    <script src="libs/panelset-0.3.0/panelset.js"></script>
    <link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
    <script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
    <script src="libs/viz-1.8.2/viz.js"></script>
    <link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
    <script src="libs/grViz-binding-1.0.11/grViz.js"></script>
    <script src="libs/kePrint-0.0.1/kePrint.js"></script>
    <link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# L1: Getting Started
]
.author[
### Jean Morrison
]
.institute[
### University of Michigan
]
.date[
### Lecture on 2026-01-08
(updated: 2026-01-06)
]

---


`\(\newcommand{\ci}{\perp\!\!\!\perp}\)`




## Lecture Outline

1. Motivation and Introduction: What is Causal Inference?

1. Counterfactuals and Definitions of Causal Effects

1. Identifying a Causal Effect

---
# 1. Introduction

---

## Motivation 

+ The idea that causality is interesting is easy to motivate: The question "Why?" motivates nearly all scientific endeavors. 

+ Causal inference formalizes what it means to answer this "Why?" question.

+ The idea that we need this formalization is much newer than the idea that causal questions are interesting. 

---

## What is Causal Inference

Causal inference consists of three elements:

- A formal language and model of causality. (Philosophy/Logic)

- A connection between this language and mathematical models. (Translation)

- Statistical inference techniques for estimating causal parameters. (Statistics) 


---

## Example: Smoking and Lung Cancer



+ In 1900 lung cancer was extremely rare. 

--

+ By the 1920's incidence of lung cancer had increased dramatically. 

--

+ Smoking was a hypothesized cause of lung cancer as early as 1912...

--

+ But so were:
  - Air pollution 
  - Asphalt dust from new roads
  - Poison gas from WWI
  - Influenza pandemic of 1918
  - Increasing use of radiography 
  - Increasing clinical awareness of lung cancer
  - Aging population


---

## The Case Against Smoking

--

- Observational studies showed a strong association between smoking and lung cancer. 

  + Earliest studies used a case/control design. 
  + Followed by prospective studies matching healthy smokers and non-smokers by age, sex, and occupation and following them over time. 
  + All studies observed a large and robust association between smoking and lung cancer (Doll and Hill estimate an OR of 40 in 1954).

--

- Supporting evidence comes from animal studies in the 1930's and 1940's: Exposing animals to tobacco products causes cancer.  

--

- Even more evidence from chemical analysis in the 1940's and 1950's: Cigarette smoke contains known cancer causing chemicals.
  + Much of this work is done by tobacco companies themselves.

--

- By the 1950's tobacco companies also believe that tobacco use causes cancer. This information is kept secret.

---

## Challenges to the Smoking-Lung Cancer Link

- Tobacco companies invested large amounts of money into research and advertising challenging the link between smoking and lung cancer. 

- In the 1960's only one third of doctors believed smoking to be a major cause of lung cancer.

- RA Fisher was a famous challenger of the smoking `\(\rightarrow\)` lung cancer hypothesis:

 + Fisher pointed to a genetic factor linked to both smoking and lung cancer, arguing this factor may be a common cause of both. 
 
 
---
## Fisher's Argument 


<div class="grViz html-widget html-fill-item" id="htmlwidget-3cdb53e7e9e7b3b846c9" style="width:90%;height:180px;"></div>
<script type="application/json" data-for="htmlwidget-3cdb53e7e9e7b3b846c9">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"Smoking\", fontname = \"Helvetica\", shape = \"oval\", fontsize = \"10\", width = \"1\", fillcolor = \"#FFFFFF\", fontcolor = \"black\", color = \"black\", pos = \"0,0!\"] \n  \"2\" [label = \"Genertic Variant\", fontname = \"Helvetica\", shape = \"oval\", fontsize = \"10\", width = \"1\", fillcolor = \"#FFFFFF\", fontcolor = \"black\", color = \"black\", pos = \"1.5,1!\"] \n  \"3\" [label = \"Lung Cancer\", fontname = \"Helvetica\", shape = \"oval\", fontsize = \"10\", width = \"1\", fillcolor = \"#FFFFFF\", fontcolor = \"black\", color = \"black\", pos = \"3,0!\"] \n\"2\"->\"1\" [color = \"black\"] \n\"2\"->\"3\" [color = \"black\"] \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>

---
## What is Wrong with Fisher's Argument?

- Fisher is right that an observational association between smoking and lung cancer could
be explained by a common cause and not by a causal effect of smoking on lung cancer. 
 
- [Cornfield et al. (1959)](https://academic.oup.com/ije/article/38/5/1175/666926?login=true) pointed out that the effect size of the hypothetical genetic 
factor would have to be huge to explain the observed data. 
  + It would have to be at least 9 times more prevalent in smokers than non-smokers and 60 times more prevalent in two-pack-a-day smokers. 
  
- The genetic hypothesis is also inconsistent with earlier low rates of lung cancer, animal studies, and reduced cancer rates in quitters.

- Even though the common cause argument is impossible to disprove, the argument for causation is supported by multiple different lines of evidence and 
concrete mechanistic hypotheses.
&lt;!-- --- --&gt;

&lt;!-- # Why did Fisher (and others) Get it Wrong? --&gt;


&lt;!-- - Some have suggested that Fisher had conflicts of interest -- he had done work as a tobacco industry consultant and was himself a smoker.  --&gt;

&lt;!-- - Fisher's statement that the association between smoking and lung cancer could be explained by a common cause is correct.  --&gt;

&lt;!-- - But that model is inconsistent with many other lines of evidence.  --&gt;

---

## Lessons Part 1: Causality is Not Statistical


- Causal inference cannot be achieved through only statistical procedures. It requires a model, assumptions, and information external to the study.

--

- All causal analyses of observational data require un-provable assumptions. 

--

"[B]ehind every causal claim there must lie some causal assumption that is not discernible from the joint distribution and, hence, not testable in observational studies. Such assumptions are usually provided by humans, resting on expert judgement. Thus, the way humans organize and communicate experiential knowledge becomes an integral part of the study, for it determines the veracity of the judgements experts are requested to articulate." - Judea Pearl, [Causality 2nd Edition (2009)](http://bayes.cs.ucla.edu/BOOK-2K/)

---
## Lessons Part 2: Importance of Observational Data

- The effect of smoking on lung cancer in humans was established entirely through observational studies. 
  + Observational studies were supported by interventional experiments done in animals.

- A randomized trial of a treatment believed to be harmful is unethical. 

- Furthermore, even if it was ethical, it is impractical to expect study participants to 
adhere to a decades-long behavioral assignment. 

- Many important factors determining human quality of life can only be studied observationally. 



---

## Early Foundations of Causal Theory


- Neyman 1923: Notation and formalization of potential outcomes introduced.

- Fisher 1925: Physical randomization of units as the "reasoned basis" for inference.

- Wright 1921: Introduced graphical models and path analysis.

---

## Languages of Causality

--

+ Potential Outcomes/counterfactuals:
  - Proposes the existence of unobserved outcomes for each unit under different possible exposures or treatments.
  - First formalized by Neyman (1923), further developed by Donald Rubin (1974 and onward) and others.
  - "Rubin causal model". 

--
+ Graphs:
  - Represents causal relationships between observed and unobserved variables as directed edges in a graph. 
  - Causal interventions are represented as modifications of the graph. 
  - Introduced by Wright (1921), further developed by Judea Pearl (1988 and onward) and others.

--
+ Structural Equations:
   - Represents causal relationships as a series of equations describing conditional probability distributions.
   - Also introduced by Wright in 1921.
   - More work by Pearl, Haavelmo, Duncan, and many more.

--
+ Under some conditions, all three languages are equivalent/mutually compatible.

---

# 2. Counterfactuals and Treatment Effects

&lt;!-- # Languages of Causality --&gt;

&lt;!-- + Causality described using potential outcomes: --&gt;
&lt;!--   - Neyman, 1923 (statistics) --&gt;
&lt;!--   - Lewis, 1973 (philosophy) --&gt;
&lt;!--   - Rubin 1974 (statistics) --&gt;
&lt;!--   - Robins, 1986 (epidemiology) --&gt;

&lt;!-- + Causality described using graphs: --&gt;
&lt;!--   + Wright, 1921 (genetics) --&gt;
&lt;!--   + Pearl, 1988 (CS, statistics) --&gt;
&lt;!--   + Sprites, Glymour, Scheines, 1993 (philosophy) --&gt;

&lt;!-- + Causality described using structural equations: --&gt;
&lt;!--    - Wright, 1921 (genetics) --&gt;
&lt;!--    - Haavelmo, 1943 (econometrics) --&gt;
&lt;!--    - Duncan, 1975 (social sciences) --&gt;
&lt;!--    - Pearl, 2000 (CS, statistics) --&gt;

&lt;!-- --- --&gt;

---

## Counterfactuals/Potential Outcomes

+ What does it mean to say that `\(A\)` causes `\(Y\)`?

--

+ A counterfactual value, `\(Y_i(A_i = a)\)` is the value of `\(Y\)` the `\(i\)`th individual **would have had** if `\(A\)` had been **intervened on** and set to `\(a\)`.

--

+ Many equivalent notations:
  - `\(Y(A = a)\)`, `\(Y(a)\)`: I will primarily use these notations. 
  - `\(Y^a\)`: This is the main notation in Hern√°n and Robins.
  - `\(Y\vert \ do(A = a)\)`: This notation emphasizes the intervention of setting `\(A\)` equal to `\(a\)` and is favored by Judea Pearl. There are some subtle differences between the "do operator" and counterfactuals. 

--

+ A counterfactual fundamentally supposes a hypothetical intervention (treatment).



&lt;!-- + I will (try to) stick with `\(Y(A = a)\)` or `\(Y(a)\)` when the meaning is unambiguous.  --&gt;

&lt;!-- -- --&gt;

&lt;!-- + We can only observe `\(Y_i\)` under a single value of `\(A_i\)`, so `\(Y_i(A_i = a)\)` is missing for all but one value of `\(a\)`. --&gt;

---

## Example: New Surgical Procedure

- Patients with a particular condition require surgery. 

- An alternative new surgical procedure is proposed. 

- We are interested in whether the new procedure leads to better outcomes than the 
standard procedure. 

- Let `\(A_i = 0\)` indicate that patient `\(i\)` received the original standard of care procedure and `\(A_i = 1\)`
indicate that they recieved the new procedure. 

- Let `\(Y_i = 0\)` indicate that the patient survived for at least 30 days after the procedure and
`\(Y_i = 1\)` indicate that they died within 30 days of the procedure.

---

## Example: New Surgical Procedure

Below is a full counterfactual table for 8 patients. 

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt;  &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(Y(A=0)\) &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(Y(A=1)\) &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 4 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 5 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 6 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 7 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 8 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

In real data, we only observe one of the two entries for each person.

---
## Sharp vs Average Causal Null

+ Sharp causal null: No effect of treatment for any individual, `$$Y_i(A_i = 1) = Y_i(A_i = 0) \qquad \forall i$$` 

+ Average causal null: The average causal effect is zero, `$$E[Y(A = 0)] = E[Y(A = 1)]$$`

+ We are usually interested in the average causal null. 

---
## Sharp vs Average Causal Null

In our example, the sharp null is false, but the average null is true.

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt;  &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(Y(A=0)\) &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(Y(A=1)\) &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 4 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 5 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 6 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 7 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 8 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
---

## Measures of Treatment Effects

+ Average treatment effect (ATE): `\(E[Y(1)] - E[Y(0)] = E[Y_i(1) - Y_i(0)]\)`

+ Risk ratio (RR): `\(E[Y(1)]/E[Y(0)]\)`

+ Odds ratio (OR; for binary outcomes): `\(\frac{E[Y(1)]/(1-E[Y(1)])}{E[Y(0)]/(1-E[Y(0)]}\)`

+ Null hypotheses ATE `\(=0\)`, RR `\(=1\)`, and OR `\(=1\)` are equivalent.

+ The ATE can be interpreted either as the difference in average outcome between groups or as the average difference.

+ This is not true for RR and OR. RR is not equal to the average risk ratio over the population.

---

## Counterfactuals and Missing Data 

+ The counterfactual framework turns causal inference into a missing data problem. 

+ Even if we were able to observe `\(A\)` and `\(Y\)` for the entire population, uncertainty would remain in our estimate of the ATE because we cannot observe both `\(Y_i(1)\)` and `\(Y_i(0)\)` for the same individual. 

+ This has been called the "fundamental problem of causal inference."


---

## Sample vs Population Treatment Effect

+ We very rarely sample the entire population of interest. 

+ Sample average treatment effect (SATE): `\(\frac{1}{n}\sum_{i = 1}^{n} Y_i(1) - \frac{1}{n}\sum_{i = 1}^{n} Y_i(0)\)`

+ Population average treatment effect (PATE): `\(E[Y(1)] - E[Y(0)]\)`, with expectation taken over a super-population. 

+ We are almost always interested in the PATE. Most of the time, when we say ATE we mean PATE.

+ Identifying the population is a scientific (rather than a statistical) task.

---

&lt;!-- ## Non-Deterministic Counterfactuals --&gt;

&lt;!-- + So far we have seen two sources of uncertainty in the ATE:  --&gt;

&lt;!--   - Missing counterfactual outcomes --&gt;
&lt;!--   - Sampling variation --&gt;

&lt;!-- + A third source is randomness in the counterfactual outcome.  --&gt;

&lt;!-- + Rather than thinking of `\(Y_i(A_i = a)\)` as a deterministic value, we can think of it as a random variable with individual specific (random) cdf `\(F_{Y_i(a)}(y)\)`.  --&gt;

&lt;!-- + We will abbreviate `\(F_{Y_i(a)}(y)\)` to `\(F_{a,i}\)`.  --&gt;

&lt;!-- --- --&gt;

&lt;!-- ## Non-Deterministic Counterfactuals --&gt;



&lt;!-- + If `\(Y_i(A_i = a)\)` is a random variable, the ATE is a double expectation: --&gt;
&lt;!--  `$$E[Y(A = a)] = E\left \lbrace E[ Y_i(A_i = a) \vert F_{a,i} ] \right \rbrace$$` --&gt;
&lt;!-- with the inside expectation taken over the distribution of `\(Y_i(A_i = a)\)` and the outer expectation taken over the population.  --&gt;

&lt;!-- + Let `\(F_{a} = E[F_{a,i}]\)` be the average counterfactual cdf.  --&gt;

&lt;!-- `$$E[Y(A =a)] = E\left[\int y \ dF_{a,i}(y) \right] = \int y \ dE[F_{a,i}(y)] = \int y \ dF_a(y)$$` --&gt;
&lt;!-- + So, the average counterfactual value is the expectation w.r.t the average counterfactual cdf.  --&gt;

&lt;!-- + The distinction between deterministic and non-deterministic counterfactuals doesn't matter for average effects.  --&gt;

&lt;!-- --- --&gt;

## Causation vs Association


![](img/1_fig1.png)

Fig 1.1 from HR

---

## Surgery Example Continued

What is the average causal effect, `\(E[Y(1)] - E[Y(0)]\)`? 

What is the association `\(E[Y \vert A = 1] - E[Y \vert A = 0]\)`? 

&lt;table class="table" style="font-size: 14px; width: auto !important; float: left; margin-right: 10px;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt;  &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(Y(A=0)\) &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(Y(A=1)\) &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(A\) &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 4 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 5 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 6 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 7 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 8 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 9 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 10 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;table class="table" style="font-size: 14px; width: auto !important; margin-right: 0; margin-left: auto"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt;  &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(Y(A=0)\) &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(Y(A=1)\) &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(A\) &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 11 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 12 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 13 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 14 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 15 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 16 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 17 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 18 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 19 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 20 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

.small[**Bold** = Observed]


---

## Surgery Example Continued

Average causal effect: `\(0.2 - 0.35 = -0.15\)` 

Association: `\(0.3 - 0.2 = 0.1\)`

&lt;table class="table" style="font-size: 14px; width: auto !important; float: left; margin-right: 10px;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt;  &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(Y(A=0)\) &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(Y(A=1)\) &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(A\) &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 4 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 5 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 6 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 7 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 8 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 9 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 10 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;table class="table" style="font-size: 14px; width: auto !important; margin-right: 0; margin-left: auto"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt;  &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(Y(A=0)\) &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(Y(A=1)\) &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(A\) &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 11 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 12 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 13 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 14 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 15 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 16 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 17 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 18 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 19 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 20 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

.small[**Bold** = Observed]

---
# 3. Identifying a Causal Effect 

---
## Identification

- A parameter is identifiable if it is theoretically estimable with a large enough 
sample. 

- Formally, let `\(\mathcal{P} = \lbrace P_\theta \vert \theta \in \Theta \rbrace\)` be a set of 
distributions parameterized by `\(\theta\)`. Then `\(\theta\)` is identifiable if unique values of `\(\theta\)`
correspond to unique distributions, i.e. `\(P_{\theta} \neq P_{\theta^\prime}\)` if `\(\theta \neq \theta^\prime\)`.

- Identifiability is a property of the model, not of a particular estimation procedure or 
a data set. 

- Knowing that `\(\theta\)` is theoretically identifiable doesn't mean we can estimate 
it well in our data. 


---
## Identification Example: Co-linearity. 

 - Suppose we model observations of `\((Y, X_1, X_2)\)` as
`$$Y_i =  \beta_0 + \beta_1 X_{1,i} + \beta_2 X_{2,i}  + \epsilon_i$$`
and `\(X_{1,i} = X_{2,i}\)` for all `\(i\)`. 

- Then `\((\beta_0, \beta_1, \beta_2)\)` is not identifiable 
because multiple values of `\(\beta_1\)` and `\(\beta_2\)` correspond to the same distribution of `\(Y\)` and therefore the 
same joint distribution of `\((Y, X_1, X_2)\)`. 

---
## Identifiability in Causal Inference

- Usually in causal inference, we are interested in ideintifying a function of 
counterfactuals such as `\(E[Y(a)]\)` or the ATE. 


---
## Conditions for Identifying an Average Counterfactual

+ Suppose we only observe `\(A\)` and `\(Y\)`. When is it possible to estimate `\(E[Y(a)]\)`?

--

+ If only `\(A\)` and `\(Y\)` are observable, `\(E[Y(a)]\)` is identifiable if

 
$$ E[Y(a)] = E[Y \vert A = a].$$

--

+ This condition holds under three assumptions:

  - Consistency
  - Stable Unit Treatment Value Assumption (SUTVA)
  - Exchangeability (exogeneity)

  
---
## Consistency

- The observed value of `\(Y_i\)` is the same as the counterfactual value `\(Y_i(A_i = a_i)\)`, where `\(a_i\)` is the treatment individual `\(i\)` actually received. 

`$$Y_i = Y_i(A_i = a_i)$$`

- In other words, the act of intervening to set `\(A_i\)` to `\(a_i\)` has no effect on the counterfactual value `\(Y_i(a_i)\)`. 

--

Surgery example:
+ A person's chance of surviving after surgery is the same whether they chose their treatment type of their own accord or were assigned to the treatment they would have chosen anyway.

--
 
+ Whether or not consistency holds may depend on the nature of the hypothesized intervention. 



---
## Stable Unit Treatment Value Assumption

1. There are no different versions of treatment available to an individual and the treatment level `\(a\)` is unambiguous for all values of `\(a\)`.

--

1. No interference: The counterfactual outcome for unit `\(i\)`, `\(Y_i (A_i = a)\)` is independent of the treatment received by other units in the study.

--

  + Formally, let `\(\mathbf{A} = (A_1, \dots, A_n)\)` be the vector of treatment assignments for all units, with `\(\mathbf{a}\)` being a single realization of `\(\mathbf{A}\)`. Let `\(a_i\)` be the `\(i\)`th element of `\(\mathbf{a}\)` and `\(\mathcal{A}^n\)` be the sample space of `\(\mathbf{A}\)`. Let `\(Y_i(\mathbf{A} = \mathbf{a})\)` be the counterfactual value of `\(Y_i\)` under the treatment vector `\(\mathbf{a}\)`. No interference is the condition that 

$$
Y_i(\mathbf{A}= \mathbf{a}) = Y_i(A_i = a_i) \ \  \ \forall\ \ \mathbf{a} \in \mathcal{A}^{n}
$$

---

## Stable Unit Treatment Value Assumption

Pair discussion:

+ Can you think of a time that "no different versions of treatment" may not hold?

+ Can you think of a time "no interference" may not hold?

---
## Subtlty in No Different Versions of Treatment

+ The "no different versions" assumption says that each individual only has one version of a given treatment available to them.

+ However, treatment may look different for different units. 

+ For example, suppose we want to compare treatments "get an annual checkup from your PCP" vs "do not get an annual checkup." 
  + Each individual may have a different PCP who does different kinds of tests. 
  + As long as they only have one PCP option, or the PCP is assigned to them, "no different versions" is satisfied. 
  + "No different versions" would be violated if individuals could select their PCP based on meaningful information. 


---

## Exchangeability

+ Exchangeability says that `\(Y(a)\)` is independent of the treatment actually received: `\(Y(a) \ci A\)`. 

--

+ Question: How is `\(Y(a) \ci A\)` different from `\(Y \ci A\)`?

--

+ Mean exchangeability: `$$E[Y(a) \vert A = a^\prime] = E[Y(a) \vert A = a^{\prime \prime}] \qquad \forall a^\prime, a^{\prime \prime} \in \mathcal{A}.$$`

--

+ Mean exchangeability is sufficient to prove `\(E[Y(a)] = E[Y \vert A = a].\)` 

--

+ For dichotomous `\(Y\)`, mean exchangeability and exchangeability are equivalent. 

--

+ What about for non-dichotomous `\(Y\)`?

&lt;!-- -- --&gt;

&lt;!-- + Full exchangeability: Let `\(Y^{\mathcal{A}} = \left \lbrace Y(a), Y(a^\prime), \dots \right \rbrace\)` be the set of all counterfactual outcomes ( `\(Y^{\mathcal{A}} = \left \lbrace Y(1), Y(0) \right \rbrace\)` for a dichotomous treatment). Full exchangeability states that  --&gt;

&lt;!-- $$ --&gt;
&lt;!-- Y^{\mathcal{A}} \ci A  --&gt;
&lt;!-- $$ --&gt;


---

## Exchangeability Example:

Does exchangeability hold in these data?

&lt;table class="table" style="font-size: 14px; width: auto !important; float: left; margin-right: 10px;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt;  &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(Y(A=0)\) &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(Y(A=1)\) &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(A\) &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 4 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 5 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 6 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 7 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 8 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 9 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 10 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;table class="table" style="font-size: 14px; width: auto !important; margin-right: 0; margin-left: auto"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt;  &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(Y(A=0)\) &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(Y(A=1)\) &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(A\) &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 11 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 12 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 13 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 14 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 15 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 16 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 17 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 18 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 19 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 20 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

.small[**Bold** = Observed]
&lt;!-- `\(E[Y(A = 0) \vert A = 0] = 0.2\)`,   `\(E[Y(A = 0) \vert A = 1] = 0.5\)` --&gt;

&lt;!-- `\(E[Y(A = 1) \vert A = 0] = 0.1\)`,   `\(E[Y(A = 1) \vert A = 1] = 0.3\)` --&gt;

---

## Exchangeability Example:

`\(E[Y(A = 0) \vert A = 0] = 0.2\)`,   `\(E[Y(A = 0) \vert A = 1] = 0.5\)`

`\(E[Y(A = 1) \vert A = 0] = 0.1\)`,   `\(E[Y(A = 1) \vert A = 1] = 0.3\)`


&lt;table class="table" style="font-size: 14px; width: auto !important; float: left; margin-right: 10px;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt;  &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(Y(A=0)\) &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(Y(A=1)\) &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(A\) &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 4 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 5 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 6 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 7 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 8 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 9 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 10 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;table class="table" style="font-size: 14px; width: auto !important; margin-right: 0; margin-left: auto"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt;  &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(Y(A=0)\) &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(Y(A=1)\) &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; \(A\) &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 11 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 12 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 13 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 14 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 15 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 16 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 17 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 18 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 19 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 20 &lt;/td&gt;
   &lt;td style="text-align:right;color: grey !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;color: black !important;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

.small[**Bold** = Observed]
---

## Identification Theorem

- Theorem: If consistency, SUTVA, and exchangeability hold, then `$$Y(a) \overset{d}{=} Y | A = a,$$` where `\(\overset{d}{=}\)` means equal in distribution. 

--

- This theorem implies that `\(E[Y(a)]\)` and any other function of population distribution of `\(Y(a)\)` 
is identifiable because we can observe `\(Y \vert A = a\)`. 

--

- Proof: 

`$$P[Y(a) \leq y] = P[Y(a) \leq y \vert A = a] \ \ \ \text{(exchangeability)}$$`
`$$= P[Y \leq y \vert A = a] \ \ \  \text{(consistency)}$$`
--

Corollary: If consistency, SUTVA, and exchangeability hold then `\(E[Y(a)] = E[Y \vert A = a]\)`

---

## Where did SUTVA come in?

+ If the levels of `\(A\)` are not clearly defined, the causal question is ill-defined (i.e. `\(Y(a)\)` is poorly defined). 

+ In the presence of interference, there is no single value of `\(Y_i(a_i)\)`. Instead, we must discuss `\(Y_i(\mathbf{a})\)`, the potential outcome given the entire vector of treatment assignments.


---

## Simple Randomized Experiments

+ Units are assigned a treatment value using a randomization procedure that is independent of all unit characteristics (e.g. flip a coin).

+ For now, we assume full compliance (everyone assigned treatment `\(a\)` receives treatment `\(a\)`).

+ Exchangeability holds by design. 

+ So, we can estimate the ATE as long as consistency and SUTVA hold.

+ One estimator is the difference in average outcomes:
`$$\frac{1}{n_{1}}\sum_{i: A_i = 1}Y_i - \frac{1}{n_2}\sum_{i:A_i = 0}Y_i = \bar{Y}_1 - \bar{Y}_0$$`

---

## Conditionally Randomized Experiments


+ Units are assigned a treatment with probability depending on a set of features, `\(L\)`.

+ If `\(L\)` and `\(Y(a)\)` are not independent, then exchangeability does not (generally) hold.

+ However, we can still identify the ATE if we have access to the randomization features `\(L\)`. 

---

## Example

+ We are conducting a trial for the new surgery option.

+ Let `\(L = 0\)` indicate that a patient is less sick and `\(L = 1\)` indicate that they are more sick.


+ We decide on a randomization scheme in which sicker patients are more likely to receive the new treatment. We set `\(P(A = 1 \vert L = 0) = 0.5\)` and `\(P(A = 1 \vert L = 1) = 0.75\)`.


---

## Example

&lt;center&gt; 

&lt;img src="img/1_trial1.png" width="80%" /&gt;

&lt;/center&gt; 
---

## Conditional Exchangeability

+ Notice that our trial looks like two fully randomized trials combined. 
  
    - In one trial, the target population is patients with `\(L = 0\)` and the treatment probability is 0.5.
    - In the other, the target population is patients with `\(L = 1\)` and the treatment probability is 0.75.

--

+ Conditional exchangeability captures the idea that data are randomized *within* levels of `\(L\)`.

--


+ Conditional exchangeability holds with respect to a set of variables `\(L\)`, if

`$$Y(a) \ci A\ \vert\ L$$`
---
## Stratum Specific Causal Effects and Standardization

+ Exchangeability holds within levels of `\(L\)`, so `\(E[Y(a) \vert L = l]\)` is identifiable.

`$$E[Y(a) \vert L = l] = E[Y \vert A = a, L = l]$$`

--

+ If we want to estimate the population level marginal counterfactual value of `\(Y\)` under treatment `\(A = a\)`, we can simply weight our estimates
by the population frequency of `\(L\)`:

`$$E[Y(a)] = \sum_{l}E[Y(a) \vert L = l]P[L = l] \\= \sum_{l}E[Y \vert A = a, L = l]P[L = l]$$`
--

+ This is called the standardized mean (standardized by population frequencies of `\(L\)`).

---
## Example

&lt;center&gt; 

&lt;img src="img/1_trial1.png" width="80%" /&gt;

&lt;/center&gt; 

`$$E[Y(0)] = \sum_{l = 0, 1}E[Y \vert A = 0, L = l]P[L = l] = (1/3)\cdot (6/10) + 1 \cdot (4/10) = 0.6\\
E[Y(1)] = \sum_{l = 0, 1}E[Y \vert A = 1, L = l]P[L = l] = 0 \cdot (6/10) + (2/3) \cdot (4/10) = 0.27\\$$`


---


## Positivity

+ Standardization trick doesn't work unless we observe all possible treatments within every level of `\(L\)`. 

+ In our surgery example, we would not be able to estimate `\(E[Y(0)]\)` if everyone with `\(L = 1\)` received treatment `\(A = 1\)`. 

--

+ The positivity condition states that at all individuals have some chance of receiving any treatment: 

`$$P[A = a \vert L = l] &gt; 0 \ \ \forall a, l$$`


---

## Identification Theorem (Conditional)

Theorem: If consistency, SUTVA, conditional exchangeability, *and positivity* hold, then `$$Y(a) \vert\ L=l\  \overset{d}{=}\  Y |\ L = l, A = a.$$` 

--

We can repeat the proof for the non-conditional theorem, conditioning on `\(L\)` in each step.

Proof: 

`$$P[Y(a) \leq y \vert L = l] = P[Y(a) \leq y \vert L=l, A = a] \ \ \ \text{(conditional exchangeability)}$$`
`$$= P[Y \leq y \vert L=l, A = a] \ \ \  \text{(consistency)}$$`

---

## Inverse Probability Weighting 

+ Rather than using standardization, we can think of our trial as a weighted sample from a larger, fully randomized trial with `\(2N\)` participants.


+ To create this large *pseudo-population*, we imagine duplicating every unit in the trial.
Each duplicate has the same value of `\(L\)` as their partner, but receives the opposite treatment. 

+ The original trial members plus unobserved, imaginary duplicates form the pseudo-population.

+ In the pseudo-population, `\(P[A = a \vert L = l] = 0.5\)` for every level of `\(l\)`, so `\(Y(a) \ci A\)`. 


+ This means that, in the pseudo-population,  `\(E[Y \vert A = a] = E[Y(a)]\)`.

---
# Inverse Probability Weighting

&lt;img src="img/1_trial2.png" width="80%" /&gt;


---
## Inverse Probability Weighting 

+ We don't get to observe `\(Y\)` for the imaginary duplicate units, so we assume that observed units are representative of unobserved units with the same values of `\(L\)` and `\(A\)`. 


+ First, we group together units in the pseudo-population by value of `\(L\)` and `\(A\)`. 

+ Then we assign weights to the observed members of each group. 


---
## Inverse Probability Weighting 

+ In our example study, there are 6 units with `\(L = 0\)` and `\(A = 0\)` and we observe `\(Y\)` for 3 of these. 

+ Each of the observed units represents 2 units in the pseudo-population, so receives weight equal 2. 

+ We observe 1 of the 4 units with `\(L = 1\)` and `\(A = 0\)`, so this unit receives weight equal to 4. 

+ We observe 3 of the 4 units with `\(L = 1\)` and `\(A = 1\)`, so each of these receives weight equal to `\(4/3\)`. 


---
# Inverse Probability Weighting

&lt;img src="img/1_trial3.png" width="80%" /&gt;


---
## Inverse Probability Weighting

+ Once we have assigned each unit a weight, `\(w_i\)`, we can estimate `\(E[Y(a)]\)` as

`$$E_{ps}[Y \vert A = a] = \frac{1}{2N}\sum_{i} w_i Y_i 1_{A_i = a} = \frac{\sum_{i} w_i Y_i 1_{A_i = a}}{\sum_i w_i}$$`
+ `\(E_{ps}\)` is the expectation in the pseudo-population.

+ We divide by `\(2N\)` because there are `\(2N\)` units in the pseudo-population.



---
## Inverse Probability Weighting 

+ Due to our construction of the pseudo-population, the number of units with `\(L = l\)` and `\(A =a\)` in the pseudo-population is equal to the total number of observed (real) units with  `\(L = l\)`. 


+ This means that each unit gets a weight equal to `\(N_{L = L_i}/N_{L = L_i, A = A_i}\)`.  
   - `\(N_{L = L_i}\)` is the number of units with `\(L = L_i\)`.
   - `\(N_{L = L_i, A = A_i}\)` is the number of units with `\(L = L_i\)` and `\(A = A_i\)`.

+ `\(N_{L = L_i, A = A_i}/N_{L = L_i}\)` is an estimate of `\(P[A = A_i \vert L = L_i]\)`. 

---
## Inverse Probability Weighting

+ For discrete `\(A\)`, the IPW identification formula is 
`$$E[Y(a)] = E\left[\frac{Y1_{A=a}}{P(A = a\vert L)}\right].$$`
+ Notice that this is only defined if `\(P(A = a \vert L = l) &gt; 0\)` for all `\(l\)`, the same as the standardization
identification formula. 

+ If `\(A\)` is continuous, we can replace `\(P(A = a \vert L)\)` with `\(f_{A \vert L}(a\vert L)\)`, the conditional pdf of `\(A\)` given `\(L\)`. 

`$$E[Y(a)] = E\left[\frac{Y1_{A=a}}{f_{A \vert L}(a\vert L)}\right].$$`

---

## Equivalence of IP Weighting and Standardization

+ Assume that `\(A\)` and `\(L\)` are discrete and `\(P[A = a \vert L = l] &gt; 0\)` for all `\(l\)` with `\(P[L = l] &gt; 0\)`.

+ Use the iterated expectation formula:

$$
`\begin{split}
E\left[\frac{I(A=a)Y}{P(A = a\vert L)}\right] =&amp;  E_L \left\lbrace E_{Y}\left[\frac{I(A=a)Y}{P(A = a\vert L)} \Bigg\vert L \right]\right\rbrace\\
=&amp;  E_L \left\lbrace \frac{P(A = a \vert L = l)E[Y \vert A = a, L = l]}{P(A = a\vert L = l)}\right\rbrace\\
= &amp; E_L \left\lbrace E[Y \vert A = a, L = l]\right\rbrace\\
=&amp; \sum_l E[Y\vert A = a, L = l] P[L = l]
\end{split}`
$$





---

## Equivalence of IP Weighting and Standardization


-  This proof extends to continuous `\(L\)` by replacing the sum in the last step with an integral. 

- It doesn't extend to continuous `\(A\)`. We will talk more about continuous treatments in Part II. For now, we will always assume that `\(A\)` has discrete levels. 

---

## Causal Effects from Observational Data

+ None of our four identification conditions consistency, SUTVA, conditional exchangeability, and positivity require that our data is from a randomized trial.

+ However, these are much stronger assumptions in observational data. 
---

## Consistency
  
- Consistency says: The outcome we observed for unit `\(i\)` ( `\(Y_i\)` ), who received treatment `\(a\)` is the same as the outcome we *would have observed* if we had intervened and set `\(A_i\)` to `\(a\)`.

`$$A_i = a \Rightarrow Y_i = Y_i(a)$$`

- In a trial with an intervention, consistency is tautological. We *did* intervene and set `\(A_i\)` to `\(a\)`. 

---
## Consistency
- In an observational study we need to think about if consistency is justified and exactly what kind of causal conclusion we want to draw. 

- For example, we may be able to provide an estimate of the effect of a hypothetical intervention that increases serum vitamin D levels without impacting anything else. 
  + But this could be different than the causal effect of increasing serum vitmamin D levels via supplementation, which may differ from the effect of increasing vitamin D level through sun exposure.

- The causal effect of choosing to meditate every day may be different than the effect of being required to meditate every day. 
  
  
---
## Conditional Exchangeability

+ In a trial, exchangeability is guaranteed by the study design. 
  - The researchers control the assignment mechanism and therefore know all of the features which contribute to treatment probabilities.
  
+ In observational studies, treatment assignment occurs "naturally".
  - Identifying a set of variables to achieve conditional exchangeability requires assumptions and external information.
  - It may not be possible to measure all necessary variables.

---

## Positivity

+ In a trial, positivity is guaranteed by design. 

+ In observational data, even if we know `\(L\)` such that `\(Y(a) \ci A\ \vert \ L\)`, there may be levels `\(L\)` for which `\(P(A = a \vert L = l)\)` is close to or exactly zero. 

---

## The Target Trial

- Hern√°n and Robins argue that, in order to identify a causal effect in observational data, we must have in mind a target trial that would identify the same parameter if it were feasible. 

- This includes clearly and specifically defining a hypothetical intervention. 

- However, that intervention doesn't necessarily need to be currently possible. 


---

## The Target Trial

- To create a target trial, we start with the data that we actually observe, or could observe if we haven't done the study yet. 

- We try to imagine a trial that could have produced the data we have on hand. 

- Finally, we analyze our observational data as though it were produced by the trial we imagined. 
   + We will see more about this in Lecture 5.


---

## Group Discussion Question


- Imagine a hypothetical trial that tests the question "Does getting a college degree increase earnings?"

- Can you imagine a trial that might produce data similar to data that are actually observable?

- Are there ways you might modify the question to make it answerable with plausibly measurable observational data?


---

## Non-Modifiable Exposures

- There are some features (e.g. race, sex, BMI) that are very hard to imagine modifying. 

- Another way to think about this is that race, sex, and body size are multi-faceted conditions. 
  - These categories include multiple physical and social features. 
  - In the case of race and sex, definitions may shift over time. 
  
- In some discrimination studies, there is a work-around: intervene on an observer's perceptions.
  - In admissions discrimination studies, the same applications are sent with different names. 
  - In studies of housing discrimination, actors of different races view apartments. 
  
- We will come back to this issue later in the semester.
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
  "highlightStyle": "github",
  "highlightLines": true,
  "countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
